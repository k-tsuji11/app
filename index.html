<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Money Leveler - Quest Log Edition</title>
    
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css" />
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #3b82f6; --gold: #f59e0b; --success: #10b981;
            --danger: #f87171; --bg: #111827; --card: #1f2937;
        }

        body { font-family: 'Noto Sans JP', sans-serif; background-color: var(--bg); color: white; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }

        .game-layout { display: grid; grid-template-columns: 350px 1fr; gap: 20px; max-width: 1000px; width: 100%; }

        /* å·¦å´ï¼šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ & å…¥åŠ› */
        .panel { background: var(--card); padding: 20px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .field { margin-bottom: 12px; }
        label { display: block; font-size: 0.7rem; color: #9ca3af; margin-bottom: 4px; }
        input { width: 100%; background: #111827; border: 1px solid #374151; border-radius: 6px; padding: 8px; color: white; box-sizing: border-box; }
        
        /* å³å´ï¼šã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ */
        .calendar-card { background: var(--card); padding: 20px; border-radius: 20px; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-top: 15px; }
        .day-cell { 
            background: #111827; border: 1px solid #374151; aspect-ratio: 1/1; 
            border-radius: 8px; display: flex; flex-direction: column; align-items: center; 
            justify-content: center; cursor: pointer; transition: 0.2s; position: relative;
        }
        .day-cell:hover { border-color: var(--primary); background: #1e293b; }
        .day-cell.active { border-color: var(--success); background: rgba(16, 185, 129, 0.1); }
        .day-num { font-size: 0.7rem; position: absolute; top: 4px; left: 4px; color: #6b7280; }
        .work-time { font-size: 0.8rem; font-weight: bold; color: var(--success); }

        .total-display { font-size: 2rem; font-weight: bold; text-align: center; margin: 15px 0; color: var(--gold); }
        .btn-update { width: 100%; padding: 12px; background: var(--primary); border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; }
        
        .header-cal { display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

<div class="game-layout">
    <div class="panel">
        <h2 style="font-size: 1rem; color: var(--primary);">CHARACTER STATS</h2>
        <div class="field"><label>æ™‚çµ¦ (ATK)</label><input type="number" id="wage" value="1200"></div>
        <div class="field"><label>åˆè¨ˆå‹¤å‹™æ™‚é–“ (é›†è¨ˆæ¸ˆã¿)</label><input type="number" id="hours" value="0" readonly style="background: #374151;"></div>
        
        <div class="total-display"><span id="net">0</span><span style="font-size: 1rem;"> å††</span></div>
        
        <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 10px; font-size: 0.8rem;">
            <div id="rank" style="color: var(--gold);">RANK: é§†ã‘å‡ºã—</div>
            <div id="advice" style="margin-top: 5px; color: #9ca3af;">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã§å‹¤å‹™è¨˜éŒ²ã‚’ä»˜ã‘ã¦ãã ã•ã„</div>
        </div>
        <button id="calc-btn" class="btn-update" style="margin-top: 15px;">QUEST RECALC ğŸ’°</button>
    </div>

    <div class="calendar-card">
        <div class="header-cal">
            <h2 style="margin: 0; font-size: 1.2rem;">QUEST LOG <span style="font-size: 0.8rem; color: #6b7280;">(1æœˆ)</span></h2>
            <div style="font-size: 0.8rem; color: var(--success);">Total: <span id="cal-total-h">0</span>h</div>
        </div>
        <div class="calendar-grid" id="calendar-body">
            </div>
    </div>
</div>

<script type="py">
from pyscript import window, document
from pyodide.ffi import create_proxy

# å‹¤å‹™ãƒ‡ãƒ¼ã‚¿ã®ç®¡ç† (æ—¥ä»˜: æ™‚é–“)
work_log = {}

def update_calc(event=None):
    wage = float(document.getElementById("wage").value or 0)
    total_h = sum(work_log.values())
    
    # æ™‚é–“ã‚’åæ˜ 
    document.getElementById("hours").value = f"{total_h:.1f}"
    document.getElementById("cal-total-h").innerText = f"{total_h:.1f}"
    
    # æ‰‹å–ã‚Šè¨ˆç®— (0.8ãŒã‘)
    net = int((wage * total_h) * 0.8)
    document.getElementById("net").innerText = f"{net:,}"
    
    # ãƒ©ãƒ³ã‚¯æ›´æ–°
    rank_el = document.getElementById("rank")
    if net >= 200000: rank_el.innerText = "RANK: ç†Ÿç·´ã®æˆ¦å£«"
    elif net >= 100000: rank_el.innerText = "RANK: ä¸­å …å†’é™ºè€…"
    else: rank_el.innerText = "RANK: é§†ã‘å‡ºã—"

def on_day_click(event):
    day = event.currentTarget.getAttribute("data-day")
    # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§æ™‚é–“ã‚’å…¥åŠ›ï¼ˆç°¡æ˜“ç‰ˆï¼‰
    val = window.prompt(f"{day}æ—¥ã®å‹¤å‹™æ™‚é–“(h)ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:", "8")
    
    if val is not None:
        try:
            h = float(val)
            work_log[day] = h
            # ã‚»ãƒ«ã®è¡¨ç¤ºã‚’æ›´æ–°
            cell = event.currentTarget
            cell.classList.add("active")
            cell.querySelector(".work-time").innerText = f"{h}h"
            update_calc()
        except:
            pass

def init_calendar():
    grid = document.getElementById("calendar-body")
    # 1ãƒ¶æœˆåˆ†(31æ—¥)ã®ã‚»ãƒ«ã‚’ä½œæˆ
    for d in range(1, 32):
        cell = document.createElement("div")
        cell.className = "day-cell"
        cell.setAttribute("data-day", str(d))
        
        num_span = document.createElement("span")
        num_span.className = "day-num"
        num_span.innerText = str(d)
        
        time_span = document.createElement("span")
        time_span.className = "work-time"
        time_span.innerText = ""
        
        cell.appendChild(num_span)
        cell.appendChild(time_span)
        cell.addEventListener("click", create_proxy(on_day_click))
        grid.appendChild(cell)

# èµ·å‹•
init_calendar()
document.getElementById("calc-btn").addEventListener("click", create_proxy(update_calc))
</script>

</body>
</html>